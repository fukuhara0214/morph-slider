<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Image Morph Slider (No Build)</title>
<style>
  :root{--bg:#f6f6f6;--fg:#222;--muted:#666;--card:#fff;--border:#ddd;}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Helvetica,Arial,sans-serif}
  .wrap{max-width:960px;margin:24px auto;padding:0 12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
  .controls{display:grid;grid-template-columns:1fr;gap:12px;margin-bottom:16px}
  @media(min-width:800px){.controls{grid-template-columns:repeat(3,1fr)}}
  .p16{padding:16px}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:4px}
  input[type="file"]{width:100%}
  .btns{display:inline-flex;border:1px solid var(--border);border-radius:12px;overflow:hidden}
  .btns button{padding:8px 10px;background:#fff;border:0;border-right:1px solid var(--border);font-size:13px}
  .btns button:last-child{border-right:0}
  .btns button.active{background:#111;color:#fff}
  .slider{width:100%}
  .hint{font-size:12px;color:var(--muted);margin-top:6px}
  .stage{position:relative;height:70vh;background:#e5e5e5;border-radius:14px;overflow:hidden;touch-action:none;user-select:none}
  .stage img{position:absolute;inset:0;width:100%;height:100%;object-fit:contain}
  .placeholder{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#777}
  .divider{position:absolute;background:#fff;opacity:.85}
  .handle{position:absolute;width:28px;height:28px;border-radius:50%;background:#111;color:#fff;
          display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,.25);font-size:14px}
</style>
</head>
<body>
<div class="wrap">
  <div class="head">
    <h1 style="margin:0;font-size:20px">Image Morph Slider</h1>
    <small style="color:#777">クライアントサイドのみ（画像は外部送信されません）</small>
  </div>

  <div class="controls">
    <div class="card p16">
      <div style="margin-bottom:10px">
        <label>画像A</label>
        <input id="fileA" type="file" accept="image/*">
      </div>
      <div>
        <label>画像B</label>
        <input id="fileB" type="file" accept="image/*">
      </div>
      <div class="hint">同じアスペクト比だと重ねが綺麗に見えます。</div>
    </div>

    <div class="card p16">
      <div style="margin-bottom:10px">
        <div style="font-size:13px;font-weight:600;margin-bottom:6px">モード</div>
        <div class="btns" id="modeBtns">
          <button data-mode="crossfade" class="active">Crossfade</button>
          <button data-mode="wipe">Wipe</button>
        </div>
      </div>
      <div>
        <div style="font-size:13px;font-weight:600;margin-bottom:6px">向き</div>
        <div class="btns" id="oriBtns">
          <button data-ori="horizontal" class="active">横（左右）</button>
          <button data-ori="vertical">縦（上下）</button>
        </div>
      </div>
    </div>

    <div class="card p16">
      <div style="font-size:13px;font-weight:600;margin-bottom:6px">バー（スライダー）</div>
      <input id="range" class="slider" type="range" min="0" max="100" value="50">
      <div class="hint"><span id="percent">50</span>% / 画像上をドラッグしても操作できます。</div>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <button id="reset" class="btns" style="border-radius:10px"><button style="padding:6px 10px;border:0;background:#f3f3f3">50%に戻す</button></button>
        <button id="clear" class="btns" style="border-radius:10px"><button style="padding:6px 10px;border:0;background:#f3f3f3">画像をクリア</button></button>
      </div>
    </div>
  </div>

  <div class="card p16">
    <div id="stage" class="stage">
      <img id="imgA" alt="A" style="display:none">
      <img id="imgB" alt="B" style="display:none">
      <div id="wipeWrap" style="position:absolute;inset:0;overflow:hidden;display:none">
        <img id="imgB2" alt="B2" style="position:absolute;inset:0;width:100%;height:100%;object-fit:contain">
      </div>
      <div id="divider" class="divider" style="display:none"></div>
      <div id="handle" class="handle" style="display:none">↔</div>
      <div id="ph" class="placeholder">まずは2枚の画像を選んでください</div>
    </div>
  </div>
</div>

<script>
(function(){
  const fileA = document.getElementById('fileA');
  const fileB = document.getElementById('fileB');
  const imgA = document.getElementById('imgA');
  const imgB = document.getElementById('imgB');
  const imgB2 = document.getElementById('imgB2');
  const stage = document.getElementById('stage');
  const ph = document.getElementById('ph');
  const range = document.getElementById('range');
  const percent = document.getElementById('percent');
  const modeBtns = document.getElementById('modeBtns');
  const oriBtns = document.getElementById('oriBtns');
  const wipeWrap = document.getElementById('wipeWrap');
  const divider = document.getElementById('divider');
  const handle = document.getElementById('handle');
  const reset = document.getElementById('reset');
  const clearBtn = document.getElementById('clear');

  let mode = 'crossfade';         // 'crossfade' | 'wipe'
  let orientation = 'horizontal'; // 'horizontal' | 'vertical'
  let reveal = 50;                 // 0..100
  let dragging = false;

  function setReveal(v){
    reveal = Math.max(0, Math.min(100, v));
    range.value = String(Math.round(reveal));
    percent.textContent = String(Math.round(reveal));
    render();
  }

  function hasBoth(){
    return imgA.src && imgB.src;
  }

  function render(){
    const both = hasBoth();
    ph.style.display = both ? 'none' : 'flex';
    imgA.style.display = imgA.src ? 'block' : 'none';

    if (!imgB.src){
      imgB.style.display = 'none';
      wipeWrap.style.display = 'none';
      divider.style.display = 'none';
      handle.style.display = 'none';
      return;
    }

    if (mode === 'crossfade'){
      imgB.style.display = 'block';
      wipeWrap.style.display = 'none';
      divider.style.display = 'none';
      handle.style.display = 'none';
      imgB.style.opacity = reveal / 100;
    } else {
      imgB.style.display = 'none';
      wipeWrap.style.display = 'block';
      imgB2.src = imgB.src;

      const rect = stage.getBoundingClientRect();
      if (orientation === 'horizontal'){
        wipeWrap.style.display = 'block';
        wipeWrap.style.clipPath = ''; // not needed
        wipeWrap.style.width = reveal + '%';
        wipeWrap.style.height = '100%';
        wipeWrap.style.bottom = '';
        // divider
        divider.style.display = 'block';
        divider.style.width = '2px';
        divider.style.left = 'calc(' + reveal + '% - 1px)';
        divider.style.top = '0';
        divider.style.bottom = '0';
        divider.style.height = '';
        // handle
        handle.style.display = 'flex';
        handle.textContent = '↔';
        handle.style.left = 'calc(' + reveal + '% - 14px)';
        handle.style.top = '50%';
        handle.style.transform = 'translateY(-50%)';
      } else {
        wipeWrap.style.width = '100%';
        wipeWrap.style.height = reveal + '%';
        wipeWrap.style.bottom = '0';
        // divider
        divider.style.display = 'block';
        divider.style.height = '2px';
        divider.style.top = 'calc(' + (100 - reveal) + '% - 1px)';
        divider.style.left = '0';
        divider.style.right = '0';
        divider.style.width = '';
        // handle
        handle.style.display = 'flex';
        handle.textContent = '↕';
        handle.style.top = 'calc(' + (100 - reveal) + '% - 14px)';
        handle.style.left = '50%';
        handle.style.transform = 'translateX(-50%)';
      }
    }
  }

  function loadFile(input, img){
    const f = input.files && input.files[0];
    if (!f) return;
    const url = URL.createObjectURL(f);
    img.onload = () => { URL.revokeObjectURL(url); render(); };
    img.src = url;
  }

  fileA.addEventListener('change', () => loadFile(fileA, imgA));
  fileB.addEventListener('change', () => loadFile(fileB, imgB));
  range.addEventListener('input', e => setReveal(parseInt(range.value || '0',10)));

  modeBtns.addEventListener('click', e=>{
    const b = e.target.closest('button'); if(!b) return;
    mode = b.dataset.mode;
    [...modeBtns.querySelectorAll('button')].forEach(x=>x.classList.toggle('active', x===b));
    render();
  });
  oriBtns.addEventListener('click', e=>{
    const b = e.target.closest('button'); if(!b) return;
    orientation = b.dataset.ori;
    [...oriBtns.querySelectorAll('button')].forEach(x=>x.classList.toggle('active', x===b));
    render();
  });

  function updateFromPointer(clientX, clientY){
    const rect = stage.getBoundingClientRect();
    if (orientation === 'horizontal'){
      const p = ((clientX - rect.left) / rect.width) * 100;
      setReveal(p);
    } else {
      const p = ((rect.bottom - clientY) / rect.height) * 100; // 下→上
      setReveal(p);
    }
  }

  stage.addEventListener('pointerdown', e=>{
    dragging = true;
    stage.setPointerCapture?.(e.pointerId);
    updateFromPointer(e.clientX, e.clientY);
  });
  stage.addEventListener('pointermove', e=>{
    if (!dragging) return;
    updateFromPointer(e.clientX, e.clientY);
  });
  stage.addEventListener('pointerup', e=>{
    dragging = false;
    stage.releasePointerCapture?.(e.pointerId);
  });
  stage.addEventListener('pointercancel', ()=> dragging = false);

  document.getElementById('reset').addEventListener('click', ()=> setReveal(50));
  document.getElementById('clear').addEventListener('click', ()=>{
    imgA.src=''; imgB.src=''; setReveal(50); render();
  });

  render();
})();
</script>
</body>
  </html>
